{% extends "base.html" %}
{% load wagtailcore_tags %}
{% load static %}
{% load widget_tweaks %}
{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">

      <div class="card shadow-sm">
        <div class="card-body p-4">

          <h2 class="text-center mb-4">Contact Us</h2>

          <form id="contact-form" method="post">
            {% csrf_token %}
            {{ form.non_field_errors }}

            {% for field in form %}
              <div class="mb-3">
                <label class="form-label">{{ field.label }}</label>
                {{ field }}
                <div class="text-danger small">{{ field.errors }}</div>
              </div>
            {% endfor %}

            <!-- reCAPTCHA -->
            <div class="d-flex justify-content-right mb-3">
              <div class="g-recaptcha" data-sitekey="{{ RECAPTCHA_PUBLIC_KEY }}"></div>
            </div>

            <button type="submit" class="btn btn-primary w-100">
              Send Message
            </button>

          </form>

          <div id="form-msg" class="text-center mt-3"></div>

        </div>
      </div>

    </div>
  </div>
</div>


<!-- WhatsApp Floating Button -->
{% if page.whatsapp_number %}
<a href="https://wa.me/{{ page.whatsapp_number }}"
   target="_blank"
   class="fixed bottom-6 right-6 bg-green-500 text-white p-4 rounded-full shadow-lg">
   ðŸ’¬
</a>
{% endif %}

<!-- reCAPTCHA -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<!-- AJAX -->
<script>
document.querySelectorAll("input, textarea").forEach(el => {
  el.classList.add("form-control");
});

document.getElementById("contact-form").addEventListener("submit", function(e) {
  e.preventDefault();

  fetch("", {
    method: "POST",
    body: new FormData(this),
    headers: {
      "X-Requested-With": "XMLHttpRequest"
    }
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      document.getElementById("form-msg").innerHTML =
        "<div class='alert alert-success'>Message sent successfully!</div>";
      this.reset();
      grecaptcha.reset();
    }
  });
});
</script>


{% endblock %}
